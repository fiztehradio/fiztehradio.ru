function zoomChartTo(e){var t=new Date,r=new Date;r.setHours(t.getHours()-e),chart.zoomToDates(r,t)}function getNearestChartDataElement(e){var t=null;return $.each(chart.chartData,function(){(null===t||Math.abs(this.category-e)<Math.abs(t-e))&&(t=this.category)}),t}function setNumberColor(e){$("#listeners-number").css("color",e)}function changelistenersNumber(){var e=$("#listeners-number");$.ajax({url:"php/icecast-listeners-number.php"}).done(function(t){e.text(t),setNumberColor(e.text()>99?"#FF0000":e.text()>49?"#F45743":e.text()>24?"#F2A232":e.text()>14?"#EDE63C":e.text()>4?"#5CAA4F":e.text()>1?"#638094":"#616161")})}var chart;$(document).ready(function(){changelistenersNumber(),chart=AmCharts.makeChart("stats-chart",{type:"serial",theme:"light",gridAboveGraphs:!0,fontSize:12,chartScrollbar:{autoGridCount:!0,graph:"totalListeners",scrollbarHeight:80,position:"bottom"},dataLoader:{url:"php/get_stats.php",format:"json",showCurtain:!0,showErrors:!0,numberFields:["timestamp","websiteListenersNumber","youtubeListenersNumber","vkListenersNumber"],postProcess:function(e,t,r){$.each(e,function(){this.timestamp*=1e3,this.totalListeners=parseInt(this.websiteListenersNumber)+parseInt(this.youtubeListenersNumber)+parseInt(this.vkListenersNumber)});var o=e[e.length-1],s={timestamp:(new Date).getTime(),websiteListenersNumber:o.websiteListenersNumber,youtubeListenersNumber:o.youtubeListenersNumber,vkListenersNumber:o.vkListenersNumber,totalListeners:o.totalListeners};return e.push(s),e}},categoryField:"timestamp",graphs:[{id:"websiteListeners",title:"Website",valueField:"websiteListenersNumber",lineAlpha:1,lineThickness:4,lineColor:"#00a1f1",balloonText:"[[value]]",bullet:"round",bulletBorderAlpha:1,bulletColor:"#FFFFFF",useLineColorForBulletBorder:!0,hideBulletsCount:50},{title:"YouTube",valueField:"youtubeListenersNumber",lineAlpha:1,lineThickness:4,lineColor:"#FF6D00",balloonText:"[[value]]",bullet:"round",bulletBorderAlpha:1,bulletColor:"#FFFFFF",useLineColorForBulletBorder:!0,hideBulletsCount:50},{title:"vk",valueField:"vkListenersNumber",lineAlpha:1,lineThickness:4,lineColor:"#00E676",balloonText:"[[value]]",bullet:"round",bulletBorderAlpha:1,bulletColor:"#FFFFFF",useLineColorForBulletBorder:!0,hideBulletsCount:50},{id:"totalListeners",valueField:"totalListeners",lineAlpha:0}],legend:{enabled:!0,useGraphSettings:!0},categoryAxis:{parseDates:!0,minPeriod:"ss"}}),$("#zoom-out-button").click(function(){chart.zoomOut()}),$("#zoom-1-hour-button").click(function(){zoomChartTo(1)}),$("#zoom-2-hour-button").click(function(){zoomChartTo(2)}),$("#zoom-6-hour-button").click(function(){zoomChartTo(6)}),$("#zoom-12-hour-button").click(function(){zoomChartTo(12)}),$("#update-chart").click(function(){console.log("update"),chart.validateData()})});